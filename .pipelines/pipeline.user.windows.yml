environment:
  host:
    os: 'windows'
    flavor: 'server'
    version: '2016'
  runtime:
    provider: 'appcontainer'
    image: 'cdpxwin.azurecr.io/global/vse2017u7/vse2017u7-external-winltsc2016-20190731:latest'
    source_mode: 'map'

version:
  major: 1
  minor: 0
  tag: 'alpha'
  name: 'CDPX-Samples'
  system: 'patch'

package_sources:
  nuget:
    feeds:
      'Toolset': 'https://msazure.pkgs.visualstudio.com/_packaging/Toolset/nuget/v3/index.json'
      'CloudES-CDP': 'https://cloudes.pkgs.visualstudio.com/_packaging/CDP/nuget/v3/index.json'
      'CloudES-Internal': 'https://cloudes.pkgs.visualstudio.com/_packaging/Internal/nuget/v3/index.json'
      'MsNugetMirror': 'https://msazure.pkgs.visualstudio.com/_packaging/MsNugetMirror/nuget/v3/index.json'
      'NugetMirror': 'https://msazure.pkgs.visualstudio.com/_packaging/NugetMirror/nuget/v3/index.json'
      'CorextMirror': 'https://msazure.pkgs.visualstudio.com/_packaging/CorextMirror/nuget/v3/index.json'
      'Official': 'https://msazure.pkgs.visualstudio.com/_packaging/Official/nuget/v3/index.json'
      'Toolset': 'https://msazure.pkgs.visualstudio.com/_packaging/Toolset/nuget/v3/index.json'
      'AzureCXP': 'https://msazure.pkgs.visualstudio.com/_packaging/AzureCXP/nuget/v3/index.json'

signing_options:
  profile: 'azure'

restore:
  commands:
    - !!defaultcommand
      name: 'Restore CSharp'
      command: 'restore.cmd'

build:
  commands:
    - !!buildcommand
      name: 'Build CSharp'
      command: 'build.cmd'
      fail_on_stderr: false
      artifacts:
        - from: 'target/distrib'
          to: 'target/distrib/AppService'
          include:
            - '**/*'
            
        - from: 'EV2Files'
          to: 'target/distrib'
          include:
            - '**/*'       

test:
  commands:
    - !!testcommand
      name: 'Test CSharp'
      command: 'test.cmd'
      testresults:
        - title: 'Unit tests'
          type: 'vstest'
          include:
           - '**\*.trx'
      codecoverage:
        - summary_file: 'reports\Cobertura.xml'
          report_directory: 'reports'
          coverage_tool: 'Cobertura'
          from: 'reports'
          include:
            - '**\*.xml'
            - '**\*.htm'


static_analysis_options:
  policheck_options:
    scan_comments: true
    files_to_scan:
      - exclude:
        - 'src\**\wwwroot\**.js'
        - 'src\**\wwwroot\**\*.exe'
        - 'src\**\wwwroot\**.md'
  binskim_options:
    files_to_scan:
      - exclude:
        - 'src\**\wwwroot\**.js'
        - 'src\**\wwwroot\**\*.exe'
        - 'src\**\wwwroot\**.md'
  moderncop_options:
    files_to_scan:
      - exclude:
        - 'src\**\wwwroot\**.js'
        - 'src\**\wwwroot\**\*.exe'
        - 'src\**\wwwroot\**.md'
        
artifact_publish_options:
  publish_to_legacy_artifacts: false            # Default is always true
  publish_to_pipeline_artifacts: true         # Default is always false
  publish_to_cloudvault_artifacts: false        # Default is always true