environment:
  host:
    os: 'windows'
    flavor: 'server'
    version: '2019'
  runtime:
    provider: 'appcontainer'
    image: 'cdpxwin1809.azurecr.io/global/vse2019:latest'
    source_mode: 'link'

signing_options:
  profile: 'internal_azure_service'   # This service deploys to Azure!

workspace_options:
 force_workspace_wipe: true

version:
  name: 'Applens'                                                  # The uber name to attach to the artifacts generated by this pipeline.
                                                                        # Currently unused, but will be used in the future to refer to the
                                                                        # artifacts as a group by name.
  major: 1                                                              # The major version number.
  minor: 0                                                              # The minor version number
  system: 'buildrevision'
  exclude_commit: false

restore:
 commands:
  - !!defaultcommand
    name: 'Restore nuget packages'
    command: 'restore.cmd'
    fail_on_stderr: true
    ignore_exitcode: false

build:
  commands:
    - !!buildcommand
      name: 'Build App Service Diagnostics'
      fail_on_stderr: true
      ignore_exitcode: false
      command: 'onebranch_build.cmd'
      artifacts:
        - from: 'build'
          include:
            - '**/*'
          exclude:
            - '**/*.pdb'


package:
  commands:
    - !!buildcommand
      name: 'Package Runtimehost and Compilerhost'
      command: 'publish.cmd'
      artifacts:
        - from: 'ServiceGroupRoot'
          to: 'Ev2ServiceGroupRoot'
          include:
            - '**/*'      
        - from: 'build'
          to: 'Ev2ServiceGroupRoot\bin'
          include:
            - '**/DiagnosticsRuntimeHost.zip'
        - from: 'build'
          to: 'Ev2ServiceGroupRoot\bin'
          include:
            - '**/DiagnosticsCompilerHost.zip'

artifact_publish_options:
  publish_to_legacy_artifacts: false            # Default is always true
  publish_to_pipeline_artifacts: true         # Default is always false
  publish_to_cloudvault_artifacts: false        # Default is always true